<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115å¹´å°èªç¾…é¦¬å­—ï¼ˆç™½è©±å­—ï¼‰ç ”ç¿’ç‡Ÿå ±åè¡¨</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Inter å­—é«” -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        /* å¼•å…¥ Noto Sans TC ä½œç‚ºä¸­æ–‡å­—é«”å‚™æ´ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f7f7f7; /* æ·ºç°è‰²åº• */
        }
        /* å®šç¾©è«è˜­è¿ªè‰²èª¿ */
        .morandi-bg-main { background-color: #b7b7a4; } /* è«è˜­è¿ªç¶ ç° */
        .morandi-bg-light { background-color: #dddccf; } /* æ·ºç°ç±³è‰² */
        .morandi-text-dark { color: #5a5a49; } /* æ·±ç¶ ç°æ–‡å­— */
        .morandi-border { border-color: #a2a295; } /* è¼ƒæ·±çš„é‚Šæ¡† */
        .morandi-input-focus:focus {
            outline: none;
            box-shadow: 0 0 0 2px #b7b7a480; /* æŸ”å’Œçš„èšç„¦é™°å½± */
            border-color: #b7b7a4;
        }
        .form-container {
            max-width: 900px;
            margin: 3rem auto;
            padding: 2rem;
            background-color: #ffffff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="form-container rounded-xl">
        <!-- æ¨™é¡Œå€å¡Š -->
        <header class="text-center pb-8 border-b morandi-border">
            <h1 class="text-3xl font-extrabold morandi-text-dark">
                115å¹´å°èªç¾…é¦¬å­—ï¼ˆç™½è©±å­—ï¼‰ç ”ç¿’ç‡Ÿ
            </h1>
            <p class="text-xl mt-1 text-gray-500">é™¢å…§åŒä»å ±åè¡¨</p>
        </header>

        <!-- å€’æ•¸è¨ˆæ™‚å™¨ -->
        <!-- 115å¹´1æœˆ10æ—¥ 08:00 (ROC 115å¹´ = 2026å¹´) -->
        <div id="countdown-timer" class="text-center mt-4 p-3 morandi-bg-light rounded-lg font-semibold text-lg morandi-text-dark shadow-md transition duration-300">
            <!-- å€’æ•¸æ™‚é–“å°‡ç”± JavaScript å¡«å…… -->
            è·é›¢é–‹èª²å€’æ•¸ï¼šè¼‰å…¥ä¸­...
        </div>

        <!-- æ´»å‹•å®—æ—¨èˆ‡è³‡è¨Š -->
        <section class="mt-8 p-6 morandi-bg-light rounded-lg shadow-inner">
            <h2 class="text-2xl font-semibold morandi-text-dark mb-4 flex items-center">
                <span class="text-3xl mr-3">ğŸ¯</span> æ´»å‹•å®—æ—¨èˆ‡è³‡è¨Š
            </h2>
            <div class="space-y-2 text-gray-700">
                <p><strong>å®—æ—¨ï¼š</strong> é¼“å‹µå…¨é™¢å“¡å·¥ç²¾é€²å°èªåŠ›ï¼Œæå‡é†«ç™‚æœå‹™å“è³ªã€‚</p>
                <p><strong>ç›®æ¨™ï¼š</strong> è®“åˆå­¸è€…ç†Ÿæ‚‰å°ç£å‚³çµ±ç¾…é¦¬å­—ã€Œç™½è©±å­—ã€çš„æ‹šå­—è¦å‰‡ã€‚</p>
                <p><strong>æ™‚é–“ï¼š</strong> 115.1/10 èˆ‡ 1/17 é€±å…­ 8:00-12:00 (ç¸½æ™‚æ•¸ 8 å°æ™‚)</p>
                <p><strong>åœ°é»ï¼š</strong> 552 æœƒè­°å®¤</p>
            </div>
        </section>

        <!-- èª²ç¨‹å ´æ¬¡ -->
        <section class="mt-10">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                <h2 class="text-2xl font-semibold morandi-text-dark flex items-center mb-3 sm:mb-0">
                    <span class="text-3xl mr-3">ğŸ“…</span> èª²ç¨‹å ´æ¬¡ (å…©å ´çš†å¿…ä¿®)
                    <!-- å‰©é¤˜åé¡ (é™é¡ 50 äºº) -->
                    <span id="spots-counter" class="text-base font-normal ml-4 p-1 px-3 bg-gray-200 text-gray-700 rounded-full border border-gray-300">
                        å‰©é¤˜åé¡ï¼šè¼‰å…¥ä¸­...
                    </span>
                </h2>
                <!-- åŠ å…¥Googleè¡Œäº‹æ›†æŒ‰éˆ• -->
                <button type="button" onclick="addToGoogleCalendar()"
                    class="bg-blue-600 text-white text-sm font-medium py-2 px-4 rounded-full shadow-md hover:bg-blue-700 transition duration-150 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="mr-2" viewBox="0 0 16 16">
                        <path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2zM3.5 11h1A1.5 1.5 0 0 1 6 12.5V13h8V8H2v5h1.5v-2z"/>
                    </svg>
                    åŠ å…¥ Google è¡Œäº‹æ›†
                </button>
            </div>
            <div class="overflow-x-auto rounded-lg border morandi-border">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="morandi-bg-main text-white">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium">æ—¥æœŸ</th>
                            <th class="px-4 py-3 text-left text-sm font-medium">æ™‚é–“</th>
                            <th class="px-4 py-3 text-left text-sm font-medium">ä¸»é¡Œ</th>
                            <th class="px-4 py-3 text-left text-sm font-medium">è¬›å¸«</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200 text-gray-700">
                        <tr>
                            <td class="px-4 py-3 whitespace-nowrap">1/10(å…­)</td>
                            <td class="px-4 py-3 whitespace-nowrap">08:00â€“12:00</td>
                            <td class="px-4 py-3">æ¯éŸ³/å­éŸ³/è²èª¿èˆ‡æ‹šå­—è¦å‰‡</td>
                            <td class="px-4 py-3 text-sm">é™³é‡‘èŠ± / æˆå¤§å°æ–‡ç³»å…¼ä»»åŠ©ç†æ•™æˆã€å°ç£ç¾…é¦¬å­—å”æœƒå¸¸å‹™ç†äº‹</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 whitespace-nowrap">1/17(å…­)</td>
                            <td class="px-4 py-3 whitespace-nowrap">08:00â€“12:00</td>
                            <td class="px-4 py-3">ç™½è©±å­—ç°¡å²ï¼æ‹¼å­—ç·´ç¿’ï¼æˆæœæª¢æ¸¬ï¼Q&A</td>
                            <td class="px-4 py-3 text-sm">è”£ç‚ºæ–‡ / æˆå¤§å°æ–‡ç³»æ•™æˆã€å°ç£èªæ–‡æ¸¬é©—ä¸­å¿ƒä¸»ä»»</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- å ±åè¡¨å–® -->
        <form id="registrationForm" class="mt-10 space-y-8">

            <!-- å€å¡Šä¸€ï¼šåŸºæœ¬è³‡æ–™ -->
            <fieldset class="border-t border-b morandi-border py-8">
                <legend class="text-2xl font-bold morandi-text-dark mb-6">ä¸€ã€åŸºæœ¬è³‡æ–™ <span class="text-sm text-red-500">(æ¨™è¨˜ * ç‚ºå¿…å¡«)</span></legend>

                <!-- å§“å -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="name" class="block text-lg font-medium morandi-text-dark">* å§“åï¼š</label>
                        <input type="text" id="name" name="name" required
                            class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                    </div>
                    <!-- äººäº‹è™Ÿ -->
                    <div>
                        <label for="employee_id" class="block text-lg font-medium morandi-text-dark">* äººäº‹è™Ÿï¼š</label>
                        <input type="text" id="employee_id" name="employee_id" required placeholder="å¦‚ï¼šA12345"
                            class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                    </div>
                </div>

                <!-- å–®ä½/ç§‘åˆ¥ -->
                <div class="mb-6">
                    <label for="department" class="block text-lg font-medium morandi-text-dark">* å–®ä½ï¼ç§‘åˆ¥ï¼š</label>
                    <input type="text" id="department" name="department" required placeholder="ä¾‹ï¼šå…§ç§‘éƒ¨ åŠ è­·ç—…æˆ¿"
                        class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                </div>

                <!-- Email -->
                <div class="mb-6">
                    <label for="email" class="block text-lg font-medium morandi-text-dark">* Emailï¼š</label>
                    <input type="email" id="email" name="email" required placeholder="å°‡ç”¨æ–¼é€šçŸ¥èª²ç¨‹è³‡è¨Š"
                        class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                </div>

                <!-- è¯çµ¡é›»è©± -->
                <div class="mb-6">
                    <p class="block text-lg font-medium morandi-text-dark">* è¯çµ¡é›»è©± (åˆ†æ©Ÿ/æ‰‹æ©Ÿ æ“‡ä¸€å¿…å¡«)ï¼š</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-2">
                        <div>
                            <label for="extension" class="sr-only">åˆ†æ©Ÿ</label>
                            <input type="text" id="extension" name="phone_extension" placeholder="åˆ†æ©Ÿè™Ÿç¢¼"
                                class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                        </div>
                        <div>
                            <label for="mobile" class="sr-only">æ‰‹æ©Ÿ</label>
                            <input type="text" id="mobile" name="phone_mobile" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼"
                                class="mt-1 block w-full rounded-md border morandi-border p-3 morandi-input-focus">
                        </div>
                    </div>
                </div>

                <!-- è·ç¨± (å–®é¸) -->
                <div>
                    <p class="block text-lg font-medium morandi-text-dark mb-3">* è·ç¨± (è«‹å–®é¸)ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="title" value="é†«å¸«" required class="morandi-radio">
                            <span class="ml-3">é†«å¸«</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="title" value="è­·ç†å¸«" class="morandi-radio">
                            <span class="ml-3">è­·ç†å¸«</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="title" value="é†«æŠ€äººå“¡" class="morandi-radio">
                            <span class="ml-3">é†«æŠ€äººå“¡ (å«è—¥/æª¢/æ”¾/å¾©å¥/ç‡Ÿé¤Šç­‰)</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="title" value="è¡Œæ”¿äººå“¡" class="morandi-radio">
                            <span class="ml-3">è¡Œæ”¿äººå“¡</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="title" value="å…¶ä»–" id="title_other_radio" class="morandi-radio">
                            <span class="ml-3">å…¶ä»–ï¼š</span>
                            <input type="text" id="title_other_text" name="title_other_text"
                                class="ml-2 px-2 py-1 border morandi-border rounded-md w-1/3 morandi-input-focus" disabled>
                        </label>
                    </div>
                </div>
            </fieldset>

            <!-- å€å¡ŠäºŒï¼šèª²ç¨‹èˆ‡ç¨‹åº¦ç¢ºèª -->
            <fieldset class="border-b morandi-border py-8">
                <legend class="text-2xl font-bold morandi-text-dark mb-6">äºŒã€èª²ç¨‹èˆ‡ç¨‹åº¦ç¢ºèª</legend>

                <!-- èª²ç¨‹å‡ºå¸­ç¢ºèª (å¿…å¡«) -->
                <div class="mb-8">
                    <p class="block text-lg font-medium morandi-text-dark mb-3">* èª²ç¨‹å‡ºå¸­ç¢ºèª (å¿…å¡«)ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="attendance_confirm" value="å…¨ç¨‹åƒåŠ " required class="morandi-checkbox">
                            <span class="ml-3">æˆ‘ç¢ºèª 1/10 (å…­) åŠ 1/17 (å…­) å…©å ´èª²ç¨‹çš†å¯å…¨ç¨‹åƒåŠ  (å…± 8 å°æ™‚)ã€‚å®Œæˆèª²ç¨‹ä¸¦é€šéæ¸¬é©—è€…ï¼Œå¯ç²å¾—å°èªç¾…é¦¬å­—åˆç´šèªè­‰ã€‚</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="attendance_session" value="æˆ‘å ±å 1/10 (å…­) 4å°æ™‚èª²ç¨‹" class="morandi-checkbox">
                            <span class="ml-3">æˆ‘å ±å 1/10 (å…­) 4å°æ™‚èª²ç¨‹</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="attendance_session" value="æˆ‘å ±å 1/17 (å…­) 4å°æ™‚èª²ç¨‹" class="morandi-checkbox">
                            <span class="ml-3">æˆ‘å ±å 1/17 (å…­) 4å°æ™‚èª²ç¨‹</span>
                        </label>
                    </div>
                </div>

                <!-- å°èªç¨‹åº¦ (å–®é¸) -->
                <div class="mb-8">
                    <p class="block text-lg font-medium morandi-text-dark mb-3">* å°èªç¨‹åº¦ (è«‹å–®é¸ï¼Œä¾›è¬›å¸«åƒè€ƒ)ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="taiwanese_level" value="å®Œå…¨åˆå­¸è€…ï¼ˆå¾é›¶é–‹å§‹ï¼‰" required class="morandi-radio">
                            <span class="ml-3">å®Œå…¨åˆå­¸è€…ï¼ˆå¾é›¶é–‹å§‹ï¼‰</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="taiwanese_level" value="è½æ‡‚ä½†ä¸å¤ªæœƒè¬›" class="morandi-radio">
                            <span class="ml-3">è½æ‡‚ä½†ä¸å¤ªæœƒè¬›</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="taiwanese_level" value="æœƒè¬›ä½†ä¸å¤ªæœƒå¯«ï¼ˆä¸ç†Ÿæ‚‰ç¾…é¦¬å­—ï¼‰" class="morandi-radio">
                            <span class="ml-3">æœƒè¬›ä½†ä¸å¤ªæœƒå¯«ï¼ˆä¸ç†Ÿæ‚‰ç¾…é¦¬å­—ï¼‰</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="radio" name="taiwanese_level" value="æœƒè¬›ä¹Ÿæœƒå¯«ï¼ˆæœ‰ç¾…é¦¬å­—åŸºç¤ï¼‰" class="morandi-radio">
                            <span class="ml-3">æœƒè¬›ä¹Ÿæœƒå¯«ï¼ˆæœ‰ç¾…é¦¬å­—åŸºç¤ï¼‰</span>
                        </label>
                    </div>
                </div>

                <!-- åƒåŠ å‹•æ©Ÿ (è¤‡é¸ï¼Œè‡³å°‘æ“‡ä¸€å¿…å¡«) -->
                <div>
                    <p class="block text-lg font-medium morandi-text-dark mb-3">* åƒåŠ å‹•æ©Ÿ (å¯è¤‡é¸ï¼Œè‡³å°‘æ“‡ä¸€å¿…å¡«)ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="motivation" value="æå‡å°èªå£èªèƒ½åŠ›" class="morandi-checkbox">
                            <span class="ml-3">æå‡å°èªå£èªèƒ½åŠ›</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="motivation" value="å­¸ç¿’å°èªæ›¸å¯«" class="morandi-checkbox">
                            <span class="ml-3">å­¸ç¿’å°èªæ›¸å¯«ï¼ˆç¾…é¦¬å­—ï¼‰</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="motivation" value="æå‡å°å°èªç—…æ‚£çš„æœå‹™å“è³ª" class="morandi-checkbox">
                            <span class="ml-3">æå‡å°å°èªç—…æ‚£çš„æœå‹™å“è³ª</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="motivation" value="èªè­˜æ›´å¤šå°èªæ–‡åŒ–" class="morandi-checkbox">
                            <span class="ml-3">èªè­˜æ›´å¤šå°èªæ–‡åŒ–</span>
                        </label>
                        <label class="flex items-center text-gray-700">
                            <input type="checkbox" name="motivation" value="å…¶ä»–" id="motivation_other_checkbox"
                                class="morandi-checkbox">
                            <span class="ml-3">å…¶ä»–ï¼š</span>
                            <input type="text" id="motivation_other_text" name="motivation_other_text"
                                class="ml-2 px-2 py-1 border morandi-border rounded-md w-1/3 morandi-input-focus" disabled>
                        </label>
                    </div>
                    <p id="motivation_error" class="text-sm text-red-500 mt-2 hidden">è«‹è‡³å°‘é¸æ“‡ä¸€å€‹åƒåŠ å‹•æ©Ÿã€‚</p>
                </div>
            </fieldset>

            <!-- é€å‡ºæŒ‰éˆ• -->
            <div class="flex justify-center pt-6">
                <button type="submit" id="submitButton"
                    class="morandi-bg-main text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-opacity-90 transition duration-300 transform hover:scale-105">
                    é€å‡ºå ±åè¡¨
                </button>
            </div>
            
            <!-- è¨Šæ¯é¡¯ç¤ºå€ (å–ä»£ alert) -->
            <div id="message_box" class="hidden text-center p-4 rounded-lg mt-4" role="alert"></div>

        </form>

        <!-- è¯çµ¡è³‡è¨Š -->
        <footer class="mt-12 pt-6 border-t morandi-border text-center text-gray-600">
            <h3 class="text-lg font-semibold morandi-text-dark mb-2">è¯çµ¡è³‡è¨Š</h3>
            <p><strong>ä¸»è¾¦å–®ä½ï¼š</strong> æ•™å­¸éƒ¨</p>
            <p><strong>è¯çµ¡äººï¼š</strong> æ—æ·‘é›… (åˆ†æ©Ÿ57438ï¼›ä¿¡ç®± cmh90022@mail.chimei.org.tw)</p>
        </footer>

    </div>

    <script>
        // Morandi Radio/Checkbox æ¨£å¼æ³¨å…¥ (CSS è¼”åŠ©)
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                /* è‡ªè¨‚ Radio æ¨£å¼ */
                .morandi-radio {
                    appearance: none;
                    width: 1.25rem;
                    height: 1.25rem;
                    border: 2px solid #a2a295;
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.2s ease-in-out;
                    vertical-align: middle; /* ç¢ºä¿å°é½Š */
                }
                .morandi-radio:checked {
                    border-color: #b7b7a4; /* è«è˜­è¿ªç¶ ç°é‚Šæ¡† */
                    background-color: #b7b7a4; /* è«è˜­è¿ªç¶ ç°å¡«å…… */
                    position: relative;
                }
                .morandi-radio:checked::after {
                    content: '';
                    display: block;
                    width: 0.5rem;
                    height: 0.5rem;
                    border-radius: 50%;
                    background: white;
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
                /* è‡ªè¨‚ Checkbox æ¨£å¼ */
                .morandi-checkbox {
                    appearance: none;
                    width: 1.25rem;
                    height: 1.25rem;
                    border: 2px solid #a2a295;
                    border-radius: 0.25rem;
                    cursor: pointer;
                    transition: all 0.2s ease-in-out;
                    display: inline-block;
                    vertical-align: middle;
                    position: relative;
                }
                .morandi-checkbox:checked {
                    border-color: #b7b7a4;
                    background-color: #b7b7a4;
                }
                .morandi-checkbox:checked::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    width: 5px;
                    height: 10px;
                    border: solid white;
                    border-width: 0 2px 2px 0;
                    transform: translate(-50%, -60%) rotate(45deg);
                }
            </style>
        `);
        
        // -----------------------------------------------------
        // Google Apps Script Web App URL (å·²æ›´æ–°)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxkp8KVN9lI5qy_wkfdx3lV_mQH0fectd-zJDJqqtwyUXHgjY-kL48HM0B12hp3fib4/exec'; 
        // -----------------------------------------------------

        const form = document.getElementById('registrationForm');
        const submitButton = document.getElementById('submitButton');
        const titleOtherRadio = document.getElementById('title_other_radio');
        const titleOtherText = document.getElementById('title_other_text');
        const motivationOtherCheckbox = document.getElementById('motivation_other_checkbox');
        const motivationOtherText = document.getElementById('motivation_other_text');
        const motivationError = document.getElementById('motivation_error');
        const extensionInput = document.getElementById('extension');
        const mobileInput = document.getElementById('mobile');
        const messageBox = document.getElementById('message_box');
        
        const countdownTimer = document.getElementById('countdown-timer');
        const spotsCounter = document.getElementById('spots-counter'); // æŠ“å–åé¡é¡¯ç¤ºçš„ span
        const MAX_SPOTS = 50; // ç¸½åé¡

        // é¡¯ç¤ºè¨Šæ¯å‡½å¼ (å–ä»£ alert)
        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.className = 'text-center p-4 rounded-lg mt-4 transition-all duration-300';
            messageBox.classList.remove('hidden');

            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-300');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-300');
            }
            
            // 5ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        // å€’æ•¸è¨ˆæ™‚å™¨é‚è¼¯
        function updateCountdown() {
            // ç›®æ¨™æ—¥æœŸï¼š115.1/10 8:00 (ROC 115å¹´ = 2026å¹´)
            const targetDate = new Date('2026-01-10T08:00:00').getTime();
            const now = new Date().getTime();
            const distance = targetDate - now;
            
            // æ™‚é–“è¨ˆç®—
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            if (distance < 0) {
                clearInterval(countdownInterval);
                countdownTimer.innerHTML = "<strong>ç ”ç¿’ç‡Ÿå·²é–‹å§‹æˆ–çµæŸï¼</strong> å ±åå·²æˆªæ­¢ã€‚";
                countdownTimer.classList.remove('morandi-bg-light', 'morandi-text-dark');
                countdownTimer.classList.add('bg-gray-200', 'text-gray-600');
                return;
            }

            countdownTimer.innerHTML = `
                è·é›¢é–‹èª²å€’æ•¸ï¼š
                <span class="text-red-600 font-extrabold">${days}</span> å¤©
                <span class="text-red-600 font-extrabold">${hours}</span> å°æ™‚
                <span class="text-red-600 font-extrabold">${minutes}</span> åˆ†
                <span class="text-red-600 font-extrabold">${seconds}</span> ç§’
            `;
        }
        
        // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚å™¨
        // updateCountdown(); // ç§»è‡³ DOMContentLoaded
        const countdownInterval = setInterval(updateCountdown, 1000);

        // *** æ–°å¢ï¼šæŠ“å–å‰©é¤˜åé¡çš„å‡½å¼ ***
        async function fetchRemainingSpots() {
            try {
                // å¢åŠ ä¸€å€‹ cache-busting åƒæ•¸ï¼Œç¢ºä¿æ¯æ¬¡éƒ½æŠ“åˆ°æœ€æ–°è³‡æ–™
                const response = await fetch(`${APPS_SCRIPT_URL}?v=${new Date().getTime()}`); 
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success && Array.isArray(result.data)) {
                    const registeredCount = result.data.length;
                    const remaining = MAX_SPOTS - registeredCount;
                    
                    if (remaining <= 0) {
                        // è™•ç†é¡æ»¿
                        spotsCounter.innerHTML = `åé¡å·²æ»¿ï¼š${registeredCount} / ${MAX_SPOTS}`;
                        spotsCounter.className = 'text-base font-normal ml-4 p-1 px-3 rounded-full border bg-red-200 text-red-800 border-red-400 font-bold';
                        
                        // ç¦ç”¨è¡¨å–®æ‰€æœ‰è¼¸å…¥æ¬„ä½
                        form.querySelectorAll('input, textarea, select').forEach(el => {
                            el.disabled = true;
                        });

                        // ç¦ç”¨é€å‡ºæŒ‰éˆ•
                        submitButton.disabled = true;
                        submitButton.textContent = 'å ±åå·²é¡æ»¿';
                        submitButton.classList.add('opacity-75', 'bg-gray-400');
                        submitButton.classList.remove('morandi-bg-main', 'hover:bg-opacity-90');

                    } else {
                        // é¡¯ç¤ºå‰©é¤˜åé¡
                        spotsCounter.innerHTML = `å‰©é¤˜åé¡ï¼š${remaining} / ${MAX_SPOTS}`;
                        spotsCounter.className = 'text-base font-normal ml-4 p-1 px-3 rounded-full border bg-red-100 text-red-600 border-red-300';
                        
                        // (å¦‚æœéœ€è¦) ç¢ºä¿è¡¨å–®æ˜¯å•Ÿç”¨çš„
                        form.querySelectorAll('input, textarea, select').forEach(el => {
                            // ä¸è¦å•Ÿç”¨é è¨­ç‚º disabled çš„æ¬„ä½
                            if (el.id !== 'title_other_text' && el.id !== 'motivation_other_text') {
                                el.disabled = false;
                            }
                        });
                        // æ ¹æ“š radio/checkbox ç‹€æ…‹é‡è¨­ "other" æ¬„ä½
                        titleOtherText.disabled = !titleOtherRadio.checked;
                        motivationOtherText.disabled = !motivationOtherCheckbox.checked;

                        submitButton.disabled = false;
                        submitButton.textContent = 'é€å‡ºå ±åè¡¨';
                        submitButton.classList.remove('opacity-75', 'bg-gray-400');
                        submitButton.classList.add('morandi-bg-main', 'hover:bg-opacity-90');
                    }
                } else {
                    throw new Error('Invalid data format from server.');
                }
            } catch (error) {
                console.error('Fetch remaining spots failed:', error);
                spotsCounter.innerHTML = 'åé¡è¼‰å…¥å¤±æ•—';
                spotsCounter.className = 'text-base font-normal ml-4 p-1 px-3 rounded-full border bg-yellow-100 text-yellow-800 border-yellow-300';
            }
        }

        // *** é é¢è¼‰å…¥æ™‚åŸ·è¡Œ ***
        document.addEventListener('DOMContentLoaded', () => {
            // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚å™¨
            updateCountdown();
            // æŠ“å–å‰©é¤˜åé¡
            fetchRemainingSpots();
        });


        // åŠ å…¥ Google è¡Œäº‹æ›†é‚è¼¯
        function addToGoogleCalendar() {
            // èª²ç¨‹ä¸€ï¼š1/10 08:00-12:00 (UTC+8 è½‰æ›)
            // Google Calendar ä½¿ç”¨ UTC æ™‚é–“ã€‚ 2026-01-10 08:00 TPE (UTC+8) æ˜¯ 2026-01-10 00:00 UTC
            // çµæŸæ™‚é–“ 12:00 TPE æ˜¯ 04:00 UTC
            const dates1 = '20260110T000000Z/20260110T040000Z'; 
            
            // èª²ç¨‹äºŒï¼š1/17 08:00-12:00
            // const dates2 = '20260117T000000Z/20260117T040000Z';
            // Google Calendar å°æ–¼å¤šå€‹äº‹ä»¶çš„ RRULE è¼ƒç‚ºè¤‡é›œï¼Œé€™è£¡å…ˆå»ºç«‹ç¬¬ä¸€å€‹äº‹ä»¶ï¼Œä¸¦åœ¨èªªæ˜ä¸­è¨»æ˜æœ‰ç¬¬äºŒå ´ã€‚

            const title = encodeURIComponent('ã€å…©å ´çš†å¿…ä¿®ã€‘115å¹´å°èªç¾…é¦¬å­—ï¼ˆç™½è©±å­—ï¼‰ç ”ç¿’ç‡Ÿ');
            const details = encodeURIComponent(
                'æœ¬ç ”ç¿’ç‡Ÿåˆ†ç‚ºå…©å ´ï¼Œçš†ç‚ºå¿…ä¿®èª²ç¨‹ã€‚\n\n' +
                'ã€èª²ç¨‹ä¸€ï¼šæ¯éŸ³/å­éŸ³/è²èª¿èˆ‡æ‹šå­—è¦å‰‡ã€‘\n' +
                'æ—¥æœŸï¼š115.1/10 (å…­) 08:00-12:00\n' +
                'è¬›å¸«ï¼šé™³é‡‘èŠ±\n\n' +
                'ã€èª²ç¨‹äºŒï¼šç™½è©±å­—ç°¡å²ï¼æ‹¼å­—ç·´ç¿’ï¼æˆæœæª¢æ¸¬ï¼Q&Aã€‘\n' +
                'æ—¥æœŸï¼š115.1/17 (å…­) 08:00-12:00\n' +
                'è¬›å¸«ï¼šè”£ç‚ºæ–‡\n\n' +
                'åœ°é»ï¼š552 æœƒè­°å®¤\n' +
                'è«‹æº–æ™‚å‡ºå¸­å…©å ´èª²ç¨‹ã€‚'
            );
            const location = encodeURIComponent('552 æœƒè­°å®¤');
            
            // ä½¿ç”¨ç¬¬ä¸€å€‹æ—¥æœŸä½œç‚ºä¸»è¦æ—¥æœŸï¼Œä¸¦åœ¨è©³æƒ…ä¸­åŒ…å«å…©å ´è³‡è¨Š
            const calendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${dates1}&details=${details}&location=${location}&ctz=Asia/Taipei`;
            
            window.open(calendarUrl, '_blank');
        }
        window.addToGoogleCalendar = addToGoogleCalendar; 

        // è·ç¨± - ã€Œå…¶ä»–ã€æ¬„ä½é€£å‹•
        document.querySelectorAll('input[name="title"]').forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'å…¶ä»–') {
                    titleOtherText.disabled = false;
                    titleOtherText.focus();
                } else {
                    titleOtherText.disabled = true;
                    titleOtherText.value = '';
                }
            });
        });

        // åƒåŠ å‹•æ©Ÿ - ã€Œå…¶ä»–ã€æ¬„ä½é€£å‹•
        motivationOtherCheckbox.addEventListener('change', () => {
            motivationOtherText.disabled = !motivationOtherCheckbox.checked;
            if (motivationOtherCheckbox.checked) {
                motivationOtherText.focus();
            } else {
                motivationOtherText.value = '';
            }
        });

        // è¡¨å–®é©—è­‰èˆ‡ Apps Script é€å‡ºé‚è¼¯
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // é˜»æ­¢å‚³çµ±è¡¨å–®é€å‡º
            messageBox.classList.add('hidden'); // éš±è—èˆŠè¨Šæ¯
            
            submitButton.disabled = true;
            submitButton.textContent = 'é€å‡ºä¸­...';
            submitButton.classList.add('opacity-75');

            // --- 1. Client-side Validation ---
            
            // 1.1. è¯çµ¡é›»è©± (åˆ†æ©Ÿ/æ‰‹æ©Ÿ æ“‡ä¸€å¿…å¡«) é©—è­‰
            if (!extensionInput.value.trim() && !mobileInput.value.trim()) {
                showMessage('è«‹å¡«å¯«è¯çµ¡é›»è©±çš„åˆ†æ©Ÿæˆ–æ‰‹æ©Ÿè™Ÿç¢¼ï¼Œæ“‡ä¸€å¿…å¡«ï¼', 'error');
                submitButton.disabled = false;
                submitButton.textContent = 'é€å‡ºå ±åè¡¨';
                submitButton.classList.remove('opacity-75');
                return;
            }

            // 1.2. åƒåŠ å‹•æ©Ÿ (è‡³å°‘æ“‡ä¸€å¿…å¡«) é©—è­‰
            const motivationCheckboxes = document.querySelectorAll('input[name="motivation"]:checked');
            if (motivationCheckboxes.length === 0) {
                motivationError.classList.remove('hidden');
                showMessage('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹åƒåŠ å‹•æ©Ÿã€‚', 'error');
                submitButton.disabled = false;
                submitButton.textContent = 'é€å‡ºå ±åè¡¨';
                submitButton.classList.remove('opacity-75');
                return;
            } else {
                motivationError.classList.add('hidden');
            }
            
            // 1.3. æª¢æŸ¥ã€Œå…¶ä»–ã€è·ç¨±æ˜¯å¦æœ‰å¡«å¯«
            if (titleOtherRadio.checked && !titleOtherText.value.trim()) {
                showMessage('è«‹å¡«å¯«è·ç¨±ã€Œå…¶ä»–ã€çš„å…·é«”å…§å®¹ã€‚', 'error');
                submitButton.disabled = false;
                submitButton.textContent = 'é€å‡ºå ±åè¡¨';
                submitButton.classList.remove('opacity-75');
                return;
            }

            // 1.4. æª¢æŸ¥ã€Œå…¶ä»–ã€å‹•æ©Ÿæ˜¯å¦æœ‰å¡«å¯«
            if (motivationOtherCheckbox.checked && !motivationOtherText.value.trim()) {
                showMessage('è«‹å¡«å¯«åƒåŠ å‹•æ©Ÿã€Œå…¶ä»–ã€çš„å…·é«”å…§å®¹ã€‚', 'error');
                submitButton.disabled = false;
                submitButton.textContent = 'é€å‡ºå ±åè¡¨';
                submitButton.classList.remove('opacity-75');
                return;
            }
            
            // --- 2. Data Collection & Formatting ---

            const titleValue = (() => {
                const selected = document.querySelector('input[name="title"]:checked');
                if (selected) {
                    return selected.value === 'å…¶ä»–' ? titleOtherText.value.trim() : selected.value;
                }
                return null;
            })();

            const motivationArray = Array.from(motivationCheckboxes).map(cb => {
                // å°‡ã€Œå…¶ä»–ã€çš„ value æ›¿æ›ç‚ºå¯¦éš›å¡«å¯«çš„å…§å®¹
                return cb.value === 'å…¶ä»–' ? `å…¶ä»–: ${motivationOtherText.value.trim()}` : cb.value;
            });
            
            // è™•ç†å‡ºå¸­ç¢ºèªï¼Œç¢ºä¿æœªå‹¾é¸æ™‚ä¹Ÿå‚³é€ã€Œå¦ã€
            const attendanceValue = document.querySelector('input[name="attendance_confirm"]:checked') ? 
                                    document.querySelector('input[name="attendance_confirm"]:checked').value : 'å¦';

            // å–å¾—ä½¿ç”¨è€…å‹¾é¸çš„å–®å ´èª²ç¨‹é¸é …ï¼ˆè‹¥æœ‰ï¼‰
            const sessionCheckboxes = document.querySelectorAll('input[name="attendance_session"]:checked');
            const sessionsArray = Array.from(sessionCheckboxes).map(cb => cb.value);

            const formData = {
                name: document.getElementById('name').value.trim(),
                employee_id: document.getElementById('employee_id').value.trim(),
                department: document.getElementById('department').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone_extension: extensionInput.value.trim(),
                phone_mobile: mobileInput.value.trim(),
                title: titleValue,
                attendance_confirm: attendanceValue,
                attendance_sessions: sessionsArray.join('; '),
                taiwanese_level: document.querySelector('input[name="taiwanese_level"]:checked')?.value || null,
                motivation: motivationArray.join('; ') // ç”¨åˆ†è™Ÿåˆ†éš”ï¼Œæ–¹ä¾¿åœ¨ Sheets ä¸­è¾¨è­˜
            };
            
            // --- 3. Send Data to Apps Script ---

            try {
                // ç™¼é€ POST è«‹æ±‚åˆ° Apps Script Web App
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // å¿…é ˆä½¿ç”¨ no-cors
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(formData)
                });
                
                // ç”±æ–¼ no-cors æ¨¡å¼é™åˆ¶ï¼Œç„¡æ³•è®€å–å¯¦éš›éŸ¿æ‡‰å…§å®¹ï¼Œ
                // Dooocode.com åªè¦ fetch æˆåŠŸå®Œæˆ (ç„¡ç¶²è·¯éŒ¯èª¤)ï¼Œå³å‡è¨­ Apps Script æ¥æ”¶æˆåŠŸä¸¦å¯«å…¥è³‡æ–™ã€‚
                showMessage('å ±åæˆåŠŸï¼è³‡æ–™å·²é€å‡ºã€‚', 'success');
                
                // æ¸…ç©ºè¡¨å–®
                form.reset();
                titleOtherText.disabled = true;
                motivationOtherText.disabled = true;

                // *** ä¿®æ”¹ï¼šé€å‡ºæˆåŠŸå¾Œï¼Œé‡æ–°æŠ“å–åé¡ ***
                await fetchRemainingSpots(); 

            } catch (error) {
                console.error('Apps Script Fetch Error:', error);
                showMessage(`å ±åå¤±æ•—ï¼šé€£ç·šéŒ¯èª¤ã€‚è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯æˆ– Apps Script éƒ¨ç½²è¨­å®šã€‚éŒ¯èª¤è¨Šæ¯: ${error.message}`, 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'é€å‡ºå ±Nâ€¦';
                submitButton.classList.remove('opacity-75');
            }
        });

    </script>

</body>
</html>
